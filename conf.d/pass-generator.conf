server {
    listen 443 ssl;
    listen [::]:443 ssl;
    http2 on;
    server_name mobilepass.itass.cloud;

    ssl_certificate /etc/ssl/itass/certificate.crt;
    ssl_certificate_key /etc/ssl/itass/private.key;

    include /etc/nginx/conf.d/common-ssl.conf;

    include /etc/nginx/conf.d/common-security-headers.conf;

    access_log /var/log/nginx/frontend-access.log main;
    error_log /var/log/nginx/frontend-error.log warn;

    location /health {
        access_log off;
        add_header Content-Type text/plain;
        return 200 "frontend-healthy\n";
    }

    location / {
        proxy_pass http://frontend:3000;
        
        include /etc/nginx/conf.d/common-proxy-headers.conf;
        
        proxy_connect_timeout 30s;
        proxy_send_timeout 30s;
        proxy_read_timeout 86400s;
    }
}

server {
    listen 443 ssl;
    listen [::]:443 ssl;
    http2 on;
    server_name wallet.itass.cloud;

    ssl_certificate /etc/ssl/itass/certificate.crt;
    ssl_certificate_key /etc/ssl/itass/private.key;

    include /etc/nginx/conf.d/common-ssl.conf;

    include /etc/nginx/conf.d/common-security-headers.conf;

    access_log /var/log/nginx/backend-access.log main;
    error_log /var/log/nginx/backend-error.log warn;

    location /health {
        access_log off;
        add_header Content-Type text/plain;
        return 200 "backend-healthy\n";
    }

    location /api/auth {
        limit_req zone=auth burst=5 nodelay;
        limit_req_log_level warn;
        
        proxy_pass http://api:3001;
        
        include /etc/nginx/conf.d/common-proxy-headers.conf;
        
        proxy_connect_timeout 10s;
        proxy_send_timeout 30s;
        proxy_read_timeout 30s;
    }

    location /api/ {
        limit_req zone=api burst=20 nodelay;
        limit_req_log_level warn;
        
        proxy_pass http://api:3001;
        
        include /etc/nginx/conf.d/common-proxy-headers.conf;
        
        proxy_connect_timeout 10s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    location / {
        proxy_pass http://api:3001;
        
        include /etc/nginx/conf.d/common-proxy-headers.conf;
        
        proxy_connect_timeout 10s;
        proxy_send_timeout 30s;
        proxy_read_timeout 30s;
    }
}
